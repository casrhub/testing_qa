- name: Start Backend & Run All Tests
  run: |
    cd backend/springboot-backend
    mvn clean spring-boot:run > backend.log 2>&1 &
    # Wait for it
    for i in {1..10}; do
      curl --silent --fail http://localhost:8080/math/add?num1=2&num2=10 && break
      echo "Waiting..."
      sleep 3
    done
    echo "Backend is up!"

    # Now run Postman
    npm install -g newman
    newman run src/test/integration/calculator.postman_collection.json

    # Now do the extra curl check
    curl -v http://localhost:8080/math/add?num1=2&num2=10

    # Start the frontend & run the UI tests
    cd ../../frontend
    npm install
    nohup npx http-server src -p 8000 --host 0.0.0.0 > http-server.log 2>&1 &
    # Wait for the UI
    for i in {1..10}; do
      curl -s http://localhost:8000 && break
      sleep 3
    done
    echo "Frontend is up!"
    ./node_modules/.bin/mocha "tests/**/*.spec.js"
